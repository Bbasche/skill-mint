"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.verifyAuthProperties = exports.removeTrailingSlash = exports.generateSignatureText = exports.composeAuthMsg = void 0;
function composeAuthMsg(authParam, domain, version, chainId) {
    let msg = '';
    msg += `${domain} wants you to sign in with your account:\n`;
    msg += `\n`;
    if (authParam.statement !== '') {
        msg += `${authParam.statement}\n`;
    }
    msg += '\n';
    // @Yaiba: Should I trust the URI provided by KGW or should I use the domain / create my own?
    msg += `URI: ${authParam.uri}\n`;
    msg += `Version: ${version}\n`;
    msg += `Chain ID: ${chainId}\n`;
    msg += `Nonce: ${authParam.nonce}\n`;
    msg += `Issue At: ${authParam.issue_at}\n`;
    msg += `Expiration Time: ${authParam.expiration_time}\n`;
    return msg;
}
exports.composeAuthMsg = composeAuthMsg;
function generateSignatureText(namespace, action, digest, challenge) {
    let sigText = 'Kwil view call.\n';
    sigText += '\n';
    sigText += `Namespace: ${namespace}\n`;
    sigText += `Method: ${action}\n`;
    sigText += `Digest: ${digest}\n`;
    sigText += `Challenge: ${challenge}\n`;
    return sigText;
}
exports.generateSignatureText = generateSignatureText;
function removeTrailingSlash(url) {
    if (url.endsWith('/')) {
        return url.slice(0, -1);
    }
    return url;
}
exports.removeTrailingSlash = removeTrailingSlash;
function verifyAuthProperties(authParm, domain, version, chainId) {
    // Normalize both domains for comparison (trim, remove trailing slash)
    const normDomain = (d) => (d || '').trim().replace(/\/+$/, '');
    if (authParm.domain && normDomain(authParm.domain) !== normDomain(domain)) {
        throw new Error(`Domain mismatch: ${authParm.domain} !== ${domain}`);
    }
    if (authParm.version && authParm.version !== version) {
        throw new Error(`Version mismatch: ${authParm.version} !== ${version}`);
    }
    if (authParm.chain_id && authParm.chain_id !== chainId) {
        throw new Error(`Chain ID mismatch: ${authParm.chain_id} !== ${chainId}`);
    }
}
exports.verifyAuthProperties = verifyAuthProperties;
//# sourceMappingURL=auth.js.map